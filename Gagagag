from hikka import loader, utils
from telethon.tl import types
import re

@loader.tds
class GramAutoClicker(loader.Module):
    """–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –¥–ª—è PR GRAM | DRAGON"""
    
    strings = {"name": "GramAutoClicker"}
    
    async def nextcmd(self, message):
        """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π—Ç–∏ –∏ –Ω–∞–∂–∞—Ç—å '–°–ª–µ–¥—É—é—â–∏–π –ø–æ—Å—Ç'"""
        async for msg in self._client.iter_messages(
            message.chat_id, 
            limit=20
        ):
            if not msg.buttons:
                continue
                
            for row in msg.buttons:
                for button in row:
                    if hasattr(button, 'text') and re.search(r'—Å–ª–µ–¥—É—é—â–∏–π –ø–æ—Å—Ç|next', button.text, re.IGNORECASE):
                        if isinstance(button, types.KeyboardButtonCallback):
                            await self._client(
                                types.GetBotCallbackAnswerRequest(
                                    peer=msg.chat_id,
                                    msg_id=msg.id,
                                    data=button.data
                                )
                            )
                            await utils.answer(message, "‚úÖ –ö–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞!")
                            return
                        elif isinstance(button, types.KeyboardButtonUrl):
                            await utils.answer(message, f"üîó –≠—Ç–æ URL-–∫–Ω–æ–ø–∫–∞: {button.url}")
                            return
            
        await utils.answer(message, "‚ùå –ö–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
